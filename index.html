<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kontakte (VCF Sync)</title>
    <link rel="stylesheet" href="style.css">
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <!-- --- HTML (Struktur) --- -->
    <div class="container">
        <header class="app-header">
            <h1>Kontakte</h1>
            <div class="header-actions">
                <button id="theme-toggle" class="icon-btn" aria-label="Theme wechseln">
                    <svg viewBox="0 0 20 20" fill="currentColor">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                    </svg>
                </button>
            </div>
        </header>

        <div class="toolbar">
            <div class="search-wrapper">
                <svg class="search-icon" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                </svg>
                <input type="text" id="search-input" placeholder="Kontakte durchsuchen..." />
                <div id="contact-count" class="contact-count"></div>
            </div>
            <div class="filter-wrapper">
                <select id="category-filter" class="filter-select">
                    <option value="">Alle Kategorien</option>
                    <option value="favorites">★ Nur Favoriten</option>
                    <option value="Familie">Familie</option>
                    <option value="Freunde">Freunde</option>
                    <option value="Arbeit">Arbeit</option>
                    <option value="Geschäft">Geschäft</option>
                    <option value="Sonstige">Sonstige</option>
                </select>
            </div>
            <div class="toolbar-buttons">
                <button id="new-contact-btn" class="btn btn-primary">
                    <svg viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    Neu
                </button>
                <button id="import-btn" class="btn">
                    <svg viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                    </svg>
                    Import
                </button>
                <button id="export-btn" class="btn">
                    <svg viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Export
                </button>
                <button id="export-selected-btn" class="btn" disabled>
                    <svg viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Auswahl exportieren
                </button>
                <button id="delete-selected-btn" class="btn btn-danger" disabled>
                    <svg viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                    Auswahl löschen
                </button>
            </div>
        </div>

        <!-- Haupt-Tab-Navigation -->
        <nav id="main-tabs" class="main-tabs">
            <button type="button" class="main-tab active" data-view="list">Kontaktliste</button>
            <button type="button" class="main-tab" data-view="stats">Auswertung</button>
        </nav>

        <!-- Kontakt-Tabs (zweite Ebene) -->
        <nav id="contact-tabs" class="contact-tabs hidden">
            <!-- Dynamisch gerendert -->
        </nav>

        <!-- Tab-Container (hält die Formulare für offene Tabs) -->
        <div id="tab-container" class="tab-container hidden">
            <!-- Dynamisch gerendert: ein Formular pro Tab -->
        </div>

        <!-- Kontaktliste (bestehende Ansicht) -->
        <main id="list-view" class="contact-list-container">
            <div id="contact-list-header" class="contact-list-header"></div>
            <div id="contact-list" class="contact-list"></div>
        </main>

        <!-- Statistik-Ansicht (neu) -->
        <section id="stats-view" class="stats-view hidden">
            <div class="stats-header">
                <h2>Datenqualität-Auswertung</h2>
                <p class="stats-subtitle">Übersicht über die Vollständigkeit Ihrer Kontaktdaten</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card stat-total">
                    <div class="stat-icon">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Kontakte gesamt</div>
                        <div id="stat-total" class="stat-value">0</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Ohne Firma</div>
                        <div id="stat-no-company" class="stat-value">0</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Ohne Titel</div>
                        <div id="stat-no-title" class="stat-value">0</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Ohne E-Mail</div>
                        <div id="stat-no-email" class="stat-value">0</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Ohne Adresse</div>
                        <div id="stat-no-address" class="stat-value">0</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" />
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Ohne Mobilnummer</div>
                        <div id="stat-no-mobile" class="stat-value">0</div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal wurde durch Tab-System ersetzt. Formulare werden dynamisch im tab-container gerendert. -->

    <!-- Duplicate Confirmation Dialog -->
    <div id="duplicate-dialog" class="modal hidden">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Duplikat gefunden!</h2>
            </div>
            <div class="modal-body">
                <p id="duplicate-dialog-message" style="margin-bottom: 1.5rem; line-height: 1.6;"></p>
            </div>
            <div class="modal-footer">
                <button type="button" id="duplicate-cancel-btn" class="btn">Abbrechen</button>
                <button type="button" id="duplicate-merge-btn" class="btn btn-primary">Zusammenführen</button>
            </div>
        </div>
    </div>

    <!-- Merge Modal -->
    <div id="merge-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>Kontakte zusammenführen</h2>
                <button type="button" id="merge-modal-close-btn" class="modal-close-btn" aria-label="Schließen">
                    <svg viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <p class="merge-info">Wählen Sie für jedes Feld, welche Daten behalten werden sollen:</p>

                <div id="merge-fields-container" class="merge-fields-container">
                    <!-- Fields will be dynamically generated here -->
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" id="merge-cancel-btn" class="btn">Abbrechen</button>
                <button type="button" id="merge-confirm-btn" class="btn btn-primary">Zusammenführen</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Hidden File Input für VCF Import -->
    <input type="file" id="vcf-input" accept=".vcf" style="display: none;">

    <!-- --- JavaScript (Logik) --- -->
    <script type="module" src="main.js"></script>
</body>
</html>